<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

   <h:head>
      <title>Comunas</title>
   </h:head>

   <h:body>
      <ui:composition template="./../../template/masterPage.xhtml">
         <ui:define name="menuHorizontal">
            <ui:include src="./../menuHorizontalRh.xhtml"/>
         </ui:define>
         <ui:define name="menuLateral">
            <ui:include src="./../menuLateralRh.xhtml"/>
         </ui:define>

         <ui:define name="center">
            <h1>Recursos Humanos -> Comunas</h1>
            <p:messages id="msg" autoUpdate="true" closable="true"/>
            <br/>
            <center>
               <h:panelGrid columns="1" width="85%">
                  <h:form id="formNovo">
                     <p:fieldset>
                        <h:panelGrid columns="3" cellpadding="5">
                           <p:outputLabel value="País"/>
                           <h:selectOneMenu id="comboPais" required="true" requiredMessage="Indique o país" value="#{itensAjaxBean.pais}"
                                            style="width: 100%" valueChangeListener="#{itensAjaxBean.changePais}">
                              <f:selectItems value="#{itensAjaxBean.paisList}" var="item"
                                             itemLabel="#{item.nomePais}" itemValue="#{item.pkIdPais}"/>
                              <f:ajax execute="@this" event="change" render="comboProv comboMun dataTable"/>
                           </h:selectOneMenu>
                           <br/>

                           <p:outputLabel value="Província"/>
                           <h:selectOneMenu id="comboProv" value="#{itensAjaxBean.provincia}" 
                                            valueChangeListener="#{itensAjaxBean.changeProvincia}"
                                            required="true" requiredMessage="Indique a província"
                                            style="width: 100%">
                              <f:selectItems value="#{itensAjaxBean.provinciaList}" var="item"
                                             itemLabel="#{item.nomeProvincia}" itemValue="#{item.pkIdProvincia}"/>
                              <f:ajax execute="@this" event="change" render="comboMun dataTable"/>
                           </h:selectOneMenu>
                           <br/>

                           <p:outputLabel value="Município"/>
                           <h:selectOneMenu id="comboMun" value="#{comunaBean.comuna.fkIdMunicipio.pkIdMunicipio}"
                                            required="true" requiredMessage="Indique o município"
                                            style="width: 100%">
                              <f:selectItems value="#{itensAjaxBean.municipioList}" var="item"
                                             itemLabel="#{item.nomeMunicipio}" itemValue="#{item.pkIdMunicipio}"/>
                              <f:ajax execute="@this" event="change" render="dataTable"/>
                           </h:selectOneMenu>
                           <p:commandButton partialSubmit="true" value="Actualizar" process="comboMun" update="dataTable"/>

                           <p:outputLabel value="Nova Comuna"/>
                           <p:inputText id="novaCom" value="#{comunaBean.comuna.descricaoComuna}" 
                                        required="true" requiredMessage="Indique o nome da comuna"/>
                           <p:commandButton value="Guardar" action="#{comunaBean.create()}" process="@this comboMun novaCom"
                                            update="novaCom dataTable"/>
                        </h:panelGrid>
                     </p:fieldset>
                     <p:dataTable id="dataTable" var="comuna" value="#{comunaBean.pesquisaPorMunicipio()}"
                                  style="width: 60%" emptyMessage="Não Existem Comunas Neste Município"
                                  paginator="true" paginatorPosition="bottom" rows="10">
                        <p:column headerText="Município">
                           <center>
                              #{comuna.fkIdMunicipio.nomeMunicipio}
                           </center>
                        </p:column>
                        <p:column headerText="Comunas">
                           <center>
                              #{comuna.descricaoComuna}
                           </center>
                        </p:column>
                        <p:column headerText="--------------------">
                           <center>
                              <p:commandButton value="Editar" icon="ui-icon-pencil" onclick="dialogEditar.show();"
                                               action="#{comunaBean.setComuna(comuna)}" process="dataTable" partialSubmit="true" 
                                               update=":formEditar:comboPaisEdit :formEditar:comboProvEdit :formEditar:comboMunEdit :formEditar:editarCom"/>
                           </center>
                        </p:column>
                     </p:dataTable>
                  </h:form>
               </h:panelGrid>
            </center>

            <center>
               <p:dialog header="Editar Província" closable="false" showEffect="fade"
                         widgetVar="dialogEditar" modal="true" closeOnEscape="true">
                  <h:form id="formEditar">
                     <p:growl autoUpdate="true"/>
                     <p:fieldset>
                        <h:panelGrid columns="4" cellpadding="5">
                           <p:outputLabel value="País"/>
                           <h:selectOneMenu id="comboPaisEdit" required="true" requiredMessage="Indique o país"
                                            valueChangeListener="#{itensAjaxBean.changePais}"
                                            value="#{itensAjaxBean.pais}"  style="width: 100%">

                              <f:selectItems value="#{itensAjaxBean.paisList}" var="item"
                                             itemLabel="#{item.nomePais}" itemValue="#{item.pkIdPais}"/>
                              <f:ajax execute="@this" event="change" render="comboProvEdit comboMunEdit"/>
                           </h:selectOneMenu>
                           <p:separator/>
                           <br/>

                           <p:outputLabel value="Província"/>
                           <h:selectOneMenu id="comboProvEdit" value="#{itensAjaxBean.provincia}" 
                                            valueChangeListener="#{itensAjaxBean.changeProvincia}"
                                            required="true" requiredMessage="Indique a província"
                                            style="width: 100%">
                              <f:selectItems value="#{itensAjaxBean.provinciaList}" var="itemProv"
                                             itemLabel="#{itemProv.nomeProvincia}" itemValue="#{itemProv.pkIdProvincia}"/>
                              <f:ajax execute="@this" event="change" render="comboMunEdit"/>
                           </h:selectOneMenu>
                           <p:separator/>
                           <br/>

                           <p:outputLabel value="Município"/>
                           <h:selectOneMenu id="comboMunEdit" value="#{comunaBean.comuna.fkIdMunicipio.pkIdMunicipio}"
                                            required="true" requiredMessage="Indique o município"
                                            style="width: 100%">
                              <f:selectItems value="#{itensAjaxBean.municipioList}" var="item"
                                             itemLabel="#{item.nomeMunicipio}" itemValue="#{item.pkIdMunicipio}"/>
                           </h:selectOneMenu>
                           <p:separator/>
                           <br/>

                           <p:outputLabel value="Nome da Comuna"/>
                           <p:inputText id="editarCom" value="#{comunaBean.comuna.descricaoComuna}"
                                        required="true" requiredMessage="Indique o nome da comuna"/>
                           <p:commandButton value="Guardar Edição" action="#{comunaBean.edit()}" process="@this comboMunEdit editarCom"
                                            onclick="dialogEditar.hide()" update=":formNovo:comboPais :formNovo:comboProv :formNovo:comboMun :formNovo:novaCom :formNovo:dataTable"/>
                           <p:commandButton value="Fechar" onclick="dialogEditar.hide()" partialSubmit="true" process="@this"
                                            action="#{comunaBean.limpar()}"/>
                        </h:panelGrid>
                     </p:fieldset>
                  </h:form>
               </p:dialog>
            </center>
         </ui:define>
      </ui:composition>
   </h:body>
</html>
